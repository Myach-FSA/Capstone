<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcome to Firebase Hosting</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/4.2.0/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/4.2.0/firebase-auth.js"></script>
  <script defer src="/__/firebase/4.2.0/firebase-database.js"></script>
  <script defer src="/__/firebase/4.2.0/firebase-messaging.js"></script>
  <script defer src="/__/firebase/4.2.0/firebase-storage.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>
  <script src="bundle.js" defer></script>
  <style media="screen">
    body {
      background: #ECEFF1;
      color: rgba(0, 0, 0, 0.87);
      font-family: Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    @media (max-width: 600px) {
      body,
      #message {
        margin-top: 0;
        background: white;
        box-shadow: none;
      }
      body {
        border-top: 16px solid #ffa100;
      }
    }

    html,
    body {
      overflow: hidden;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #renderCanvas {
      width: 100%;
      height: 100%;
      touch-action: none;
    }
  </style>
  <script src="babylon.js"></script>
  <!-- <script src="hand.js"></script> -->
  <script src="cannon.js"></script>
</head>

<body>
  <div>
    <canvas id="renderCanvas"></canvas>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', function () {
      // your code here
      var canvas = document.getElementById('renderCanvas');
      var engine = new BABYLON.Engine(canvas, true);
      var createScene = function () {

        // This creates a basic Babylon Scene object (non-mesh)
        var scene = new BABYLON.Scene(engine);
        var gravityVector = new BABYLON.Vector3(0, -9.81, 0);
        var physicsPlugin = new BABYLON.CannonJSPlugin();
        scene.enablePhysics(gravityVector, physicsPlugin);
        scene.collisionsEnabled = true;
        // scene.setGravity(new BABYLON.Vector3(0, -9.8, 0));

        var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 20, -40), scene);
        // This targets the camera to scene origin
        camera.setTarget(BABYLON.Vector3.Zero());
        // This attaches the camera to the canvas
        camera.attachControl(canvas, false);
        // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
        var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
        // Default intensity is 1. Let's dim the light a small amount
        light.intensity = 0.7;
        // Our built-in 'sphere' shape. Params: name, subdivs, size, scene
        var sphere = BABYLON.Mesh.CreateSphere("sphere1", 16, 2, scene);
        sphere.position.y = 2;
        var ground = BABYLON.Mesh.CreateGround("ground1", 40, 40, 2, scene);

        var curvePoints = function (l, t) {
          var path = [];
          var step = l / t;
          var a = 5;
          for (var i = -l / 2; i < l / 2; i += step) {
            path.push(new BABYLON.Vector3(5 * Math.sin(i * t / 400), i, 5 * Math.cos(i * t / 400)));
          }
          return path;
        };
        var curve = curvePoints(40, 100);

        var tube = BABYLON.Mesh.CreateTube("tube", curve, 2, 60, null, 0, scene);

        // var camera = new BABYLON.FollowCamera("FollowCam", new BABYLON.Vector3(0, 0, 0), scene, sphere);
        sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, {
          mass: 0.01,
          friction: 0.5,
          restitution: 0.7
        }, scene);
        ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, {
          mass: 0,
          restitution: 0.9
        }, scene);

        sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(0, 0, 0, 0));

        let zAxis = 0;
        let xAxis = 0;
        let yAxis = 0;

        function moveLeft(obj) {
          xAxis += .25;
          obj.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(zAxis, 0, xAxis, 0));
        }

        function moveRight(obj) {
          xAxis -= .25;
          obj.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(zAxis, 0, xAxis, 0));
        }

        function moveUp(obj) {
          zAxis += .25;
          obj.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(zAxis, 0, xAxis, 0));
        }

        function moveDown(obj) {
          zAxis -= .25;
          obj.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(zAxis, 0, xAxis, 0));
        }


        window.onkeydown = function (e) {
          if (e.key === ' ') {
            sphere.position.y = 4;
          }
          if (e.key === 'ArrowLeft') {
            moveLeft(sphere)
          }
          if (e.key === 'ArrowRight') {
            moveRight(sphere);
          }
          if (e.key === 'ArrowUp') {
            moveUp(sphere);
          }
          if (e.key === 'ArrowDown') {
            moveDown(sphere);
          }
        }

        var ballMaterial = new BABYLON.StandardMaterial('material', scene);
        var tubeMaterial = new BABYLON.StandardMaterial('material', scene);
        var textureTube = new BABYLON.Texture('stone.png', scene);
        var textureBall = new BABYLON.Texture('net.png', scene);

        ballMaterial.diffuseColor = new BABYLON.Color3(2.0, 1, 0.7);
        ballMaterial.diffuseTexture = textureBall;
        ballMaterial.diffuseTexture.hasAlpha = true;
        sphere.material = ballMaterial;

        tubeMaterial.diffuseTexture = textureTube;
        tube.material = tubeMaterial;

        var groundMaterial = new BABYLON.StandardMaterial('material', scene);
        var textureGrass = new BABYLON.Texture('grass-large.png', scene);
        groundMaterial.diffuseTexture = textureGrass;
        ground.material = groundMaterial;

        return scene;

      };
      var scene = createScene();
      engine.runRenderLoop(function () {
        scene.render();
      });
      window.addEventListener('resize', function () {
        engine.resize();
      });
    });

    </script>
  </div>
  <p id="load">Firebase SDK Loading&hellip;</p>

  
  <script>
      document.addEventListener('DOMContentLoaded', function () {
        // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

        try {
          let app = firebase.app();
          let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
          console.error(e);
          document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
        }
      });
  </script>
</body>

</html>
